ken = file.path(dir, "./ken/hydroloop_results/csv"),
mli = file.path(dir, "/mli/csv_km3")
) %>%
lapply(list.files, pattern="*.csv", recursive=TRUE, full.names=TRUE) %>%
lapply(data.table) %>%
rbindlist(idcol="iso3", use.names=TRUE, fill=TRUE) %>%
setnames("V1", "path")
# Extract timestamps and sheets from file names
data[, `:=`(
file = basename(path),
path = str_replace(path, dir, "")
)][, `:=`(
year = str_extract(file, "_[0-9]{4}") %>% str_sub(2,5) %>% as.integer(),
month = str_extract(file, "[0-9]{4}_[0-9]{1,2}") %>% str_sub(6,7) %>% as.integer(),
sheet = str_extract(tolower(file), "sheet[0-9]{1}")
)] %>% setorder(iso3, sheet, year, month, na.last=TRUE)
# Append flow units (typically km3 or MCM, will need to be specified manually)
data[, unit := fcase(
iso3=="mli", "km3",
iso3=="ken", "km3"
)]
data[iso3=="ken" & is.na(month), .(iso3, file, sheet, year, month)] %>%
paged_table()
data[iso3=="ken" & is.na(month), unique(Sheet)]
data[iso3=="ken" & is.na(month), unique(sheet)]
data[iso3=="ken" & is.na(month), uniqueN(file)]
data[iso3=="ken" & !is.na(year), .(iso3, file, sheet, year)] %>%
paged_table()
data[iso3=="ken" & is.na(month), .(iso3, file, sheet, year)] %>%
paged_table()
data[iso3=="ken" & !is.na(month), .(iso3, file, sheet, year, month)] %>%
paged_table()
data[iso3=="ken" & !is.na(year) & is.na(month), .(iso3, file, sheet, year)] %>%
paged_table()
data[iso3=="ken" & !is.na(month), .(iso3, file, sheet, year, month)] %>%
paged_table()
data[iso3=="ken" & is.na(year) & is.na(month), .(iso3, file, sheet, year, month)] %>%
paged_table()
data <- lapply(1:nrow(f), function(x) fread(f[x, path])[, `:=`(
iso3 = f[x, iso3],
sheet = f[x, sheet],
year = f[x, year]
)]) %>% rbindlist()
f <- data[iso3=="mli"]
data <- lapply(1:nrow(f), function(x) fread(f[x, path])[, `:=`(
iso3 = f[x, iso3],
sheet = f[x, sheet],
year = f[x, year]
)]) %>% rbindlist()
# List all output CSV
data <- list(
ken = file.path(dir, "./ken/hydroloop_results/csv"),
mli = file.path(dir, "/mli/csv_km3")
) %>%
lapply(list.files, pattern="*.csv", recursive=TRUE, full.names=TRUE) %>%
lapply(data.table) %>%
rbindlist(idcol="iso3", use.names=TRUE, fill=TRUE) %>%
setnames("V1", "path")
# Extract timestamps and sheets from file names
data[, `:=`(
file = basename(path)
)][, `:=`(
year = str_extract(file, "_[0-9]{4}") %>% str_sub(2,5) %>% as.integer(),
month = str_extract(file, "[0-9]{4}_[0-9]{1,2}") %>% str_sub(6,7) %>% as.integer(),
sheet = str_extract(tolower(file), "sheet[0-9]{1}")
)] %>% setorder(iso3, sheet, year, month, na.last=TRUE)
# Append flow units (typically km3 or MCM, will need to be specified manually)
data[, unit := fcase(
iso3=="mli", "km3",
iso3=="ken", "km3"
)]
f <- data[iso3=="mli"]
data <- lapply(1:nrow(f), function(x) fread(f[x, path])[, `:=`(
iso3 = f[x, iso3],
sheet = f[x, sheet],
year = f[x, year]
)]) %>% rbindlist()
data %>% paged_table()
data[year==min(year), uniqueN(VARIABLE)]
data[year==min(year), uniqueN(paste(SUBCLASS, VARIABLE))]
data[year==min(year), uniqueN(paste(CLASSS, SUBCLASS, VARIABLE))]
data[year==min(year), uniqueN(paste(CLASS, SUBCLASS, VARIABLE))]
library(ggplot2)
setnames(data, tolower(names(data)))
data %>%
ggplot() +
geom_area(aes(value)) +
scale_fill_hcl(palette="RdBu", reverse=T) +
facet_grid(year~class) +
theme_few()
data %>%
ggplot() +
geom_area(aes(value)) +
scale_fill_viridis_c() +
facet_grid(year~class) +
theme_few()
data %>%
ggplot() +
geom_area(aes(value, year)) +
scale_fill_viridis_c() +
facet_grid(variable~paste(class, subclass), scales="free")
data %>%
ggplot() +
geom_area(aes(value, year)) +
scale_fill_viridis_c() +
facet_wrap(variable~paste(class, subclass), scales="free")
data %>%
ggplot() +
geom_area(aes(year, value)) +
scale_fill_viridis_c() +
facet_wrap(variable~paste(class, subclass))
data %>%
ggplot() +
geom_area(aes(year, value)) +
scale_fill_viridis_c() +
facet_wrap(variable~paste(class, subclass), scales="free_y")
data %>%
ggplot() +
geom_area(aes(year, value)) +
scale_fill_viridis_c() +
facet_wrap(paste(class, subclass, variable), ncol=1, scales="free_y")
data %>%
ggplot() +
geom_area(aes(year, value)) +
scale_fill_viridis_c() +
facet_wrap(paste(class, subclass, variable)~., ncol=1, scales="free_y")
data %>%
ggplot() +
geom_area(aes(year, value)) +
scale_fill_viridis_c() +
facet_wrap(paste(class, subclass, variable)~., ncol=1, scales="free_y") +
theme(
panel.spacing.y = unit(0, "lines"),
axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank(),
panel.border = element_blank()
) +
labs(x=NULL, y=NULL) +
ggtitle("Average daily temperature in Copenhagen", "from 1995 to 2019")
devtools::install_github("rivasiker/ggHoriPlot")
# Chunk 1: init
library(ggplot2)
library(ggHoriPlot)
# Load this development package
devtools::load_all(".")
# Location of model output datasets
dir <- getOption("wa.data")
# Chunk 2
# List all output CSV
data <- list(
ken = file.path(dir, "./ken/hydroloop_results/csv"),
mli = file.path(dir, "/mli/csv_km3")
) %>%
lapply(list.files, pattern="*.csv", recursive=TRUE, full.names=TRUE) %>%
lapply(data.table) %>%
rbindlist(idcol="iso3", use.names=TRUE, fill=TRUE) %>%
setnames("V1", "path")
# Extract timestamps and sheets from file names
data[, `:=`(
file = basename(path)
)][, `:=`(
year = str_extract(file, "_[0-9]{4}") %>% str_sub(2,5) %>% as.integer(),
month = str_extract(file, "[0-9]{4}_[0-9]{1,2}") %>% str_sub(6,7) %>% as.integer(),
sheet = str_extract(tolower(file), "sheet[0-9]{1}")
)] %>% setorder(iso3, sheet, year, month, na.last=TRUE)
# Append flow units (typically km3 or MCM, will need to be specified manually)
data[, unit := fcase(
iso3=="mli", "km3",
iso3=="ken", "km3"
)]
# Chunk 3
data[iso3=="mli", .(iso3, file, sheet, year, month)] %>%
paged_table()
# Chunk 4
data[iso3=="ken" & !is.na(year) & is.na(month), .(iso3, file, sheet, year)] %>%
paged_table()
# Chunk 5
data[iso3=="ken" & !is.na(month), .(iso3, file, sheet, year, month)] %>%
paged_table()
# Chunk 6
data[iso3=="ken" & is.na(year) & is.na(month), .(iso3, file, sheet)] %>%
paged_table()
library(rmarkdown)
f <- data[iso3=="mli"]
mli <- lapply(1:nrow(f), function(x) fread(f[x, path])[, `:=`(
iso3 = f[x, iso3],
sheet = f[x, sheet],
year = f[x, year]
)]) %>% rbindlist()
setnames(mli, tolower(names(mli)))
mli %>% paged_table()
mli %>%
ggplot() +
geom_horizon(aes(year, value)) +
scale_fill_viridis_c() +
facet_grid(paste(class, subclass, variable)~.)
mli %>%
ggplot() +
geom_horizon(aes(year, value)) +
#scale_fill_viridis_c() +
facet_grid(paste(class, subclass, variable)~.)
mli %>%
ggplot() +
geom_horizon(aes(year, value)) +
scale_fill_viridis_d(alpha=.6) +
facet_grid(paste(class, subclass, variable)~.)
mli %>%
ggplot() +
geom_horizon(aes(year, value)) +
scale_fill_viridis_d(alpha=.6) +
facet_grid(paste(class, subclass, variable)~.) +
theme(
panel.spacing.y = unit(0, "lines"),
strip.text.y = element_text(size=7, angle=0, hjust=0),
axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank(),
panel.border = element_blank()
)
mli %>%
ggplot() +
geom_horizon(aes(year, value)) +
scale_fill_viridis_d(alpha=.6) +
facet_grid(paste(class, subclass, variable)~.) +
theme_few() +
theme(
legend.position = "none",
panel.spacing.y = unit(0, "lines"),
strip.text.y = element_text(size=7, angle=0, hjust=0),
panel.border = element_blank()
) +
labs(x=NULL, y=NULL) +
ggtitle("WA+ Sheet 1 Variables", "Mali, 2009 to 2016")
mli %>%
ggplot() +
geom_horizon(aes(year, value)) +
scale_fill_viridis_d(alpha=.6) +
facet_grid(paste(class, subclass, variable)~.) +
theme(
legend.position = "none",
panel.spacing.y = unit(0, "lines"),
strip.text.y = element_text(size=7, angle=0, hjust=0),
strip.background = element_blank(),
panel.border = element_blank()
) +
labs(x=NULL, y=NULL) +
ggtitle("WA+ Sheet 1 Variables", "Mali, 2009 to 2016")
mli %>%
ggplot() +
geom_horizon(aes(year, value)) +
scale_fill_viridis_d(alpha=.6) +
facet_grid(paste(class, subclass, variable)~.) +
theme(
legend.position = "none",
panel.spacing.y = unit(0, "lines"),
strip.text.y = element_text(size=7, angle=0, hjust=0),
strip.background = element_blank(),
axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank(),
panel.border = element_blank()
) +
labs(x=NULL, y=NULL) +
ggtitle("WA+ Sheet 1 Variables", "Mali, 2009 to 2016")
mli %>%
ggplot() +
geom_horizon(aes(year, value)) +
scale_fill_viridis_d(alpha=.6) +
facet_grid(paste(class, subclass, variable)~.) +
theme(
legend.position = "none",
panel.spacing.y = unit(0, "lines"),
strip.text.y = element_text(size=7, angle=0, hjust=0),
strip.background = element_blank(),
axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank(),
panel.border = element_blank(),
panel.grid = element_blank()
) +
labs(x=NULL, y=NULL) +
ggtitle("WA+ Sheet 1 Variables", "Mali, 2009 to 2016")
th <- theme(
legend.position = "none",
panel.spacing.y = unit(0, "lines"),
strip.text.y = element_text(size=7, angle=0, hjust=0),
strip.background = element_blank(),
axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank(),
panel.border = element_blank(),
panel.grid = element_blank(),
panel.background = element_blank()
)
mli %>%
ggplot() +
geom_horizon(aes(year, value)) +
scale_fill_viridis_d(alpha=.6) +
facet_grid(paste(class, subclass, variable)~.) +
th() +
labs(x=NULL, y=NULL) +
ggtitle("WA+ Sheet 1 Variables", "Mali, 2009 to 2016")
th <- function() theme(
legend.position = "none",
panel.spacing.y = unit(0, "lines"),
strip.text.y = element_text(size=7, angle=0, hjust=0),
strip.background = element_blank(),
axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank(),
panel.border = element_blank(),
panel.grid = element_blank(),
panel.background = element_blank(),
...)
mli %>%
ggplot() +
geom_horizon(aes(year, value)) +
scale_fill_viridis_d(alpha=.6) +
facet_grid(paste(class, subclass, variable)~.) +
th() +
labs(x=NULL, y=NULL) +
ggtitle("WA+ Sheet 1 Variables", "Mali, 2009 to 2016")
th <- function(...) theme(
legend.position = "none",
panel.spacing.y = unit(0, "lines"),
strip.text.y = element_text(size=7, angle=0, hjust=0),
strip.background = element_blank(),
axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank(),
panel.border = element_blank(),
panel.grid = element_blank(),
panel.background = element_blank(),
...)
mli %>%
ggplot() +
geom_horizon(aes(year, value)) +
scale_fill_viridis_d(alpha=.6) +
facet_grid(paste(class, subclass, variable)~.) +
th() +
labs(x=NULL, y=NULL) +
ggtitle("WA+ Sheet 1 Variables", "Mali, 2009 to 2016")
mli %>% paged_table()
mli %>%
ggplot() +
geom_line(aes(year, value)) +
scale_fill_viridis_d(alpha=.6) +
facet_grid(paste(class, subclass, variable)~.) +
th() +
labs(x=NULL, y=NULL) +
ggtitle("WA+ Sheet 1 Variables", "Mali, 2009 to 2016")
mli %>%
ggplot() +
geom_line(aes(year, value)) +
scale_fill_viridis_d(alpha=.6) +
facet_grid(paste(class, subclass, variable)~., scales="free_y") +
th() +
labs(x=NULL, y=NULL) +
ggtitle("WA+ Sheet 1 Variables", "Mali, 2009 to 2016")
mli %>%
ggplot() +
geom_line(aes(year, value)) +
scale_color_viridis_d(alpha=.6) +
facet_grid(paste(class, subclass, variable)~., scales="free_y") +
th() +
labs(x=NULL, y=NULL) +
ggtitle("WA+ Sheet 1 Variables", "Mali, 2009 to 2016")
mli %>%
ggplot() +
geom_line(aes(year, value, color=subclass)) +
scale_color_viridis_d(alpha=.6) +
facet_grid(paste(class, subclass, variable)~., scales="free_y") +
th() +
labs(x=NULL, y=NULL) +
ggtitle("WA+ Sheet 1 Variables", "Mali, 2009 to 2016")
f <- data[iso3=="ken"]
f <- data[iso3=="ken" & !is.na(month) & sheet=="sheet1"]
ken <- lapply(1:nrow(f), function(x) fread(f[x, path])[, `:=`(
iso3 = f[x, iso3],
sheet = f[x, sheet],
year = f[x, year]
)]) %>% rbindlist()
setnames(ken, tolower(names(ken)))
ken %>% paged_table()
ken %>%
ggplot() +
geom_line(aes(year, value, color=subclass)) +
scale_color_viridis_d(alpha=.6) +
facet_grid(paste(class, subclass, variable)~., scales="free_y") +
th() +
labs(x=NULL, y=NULL) +
ggtitle("WA+ Sheet 1 Variables", "Kenya, 2009 to 2016")
f <- data[iso3=="ken" & !is.na(month) & sheet=="sheet1"]
ken <- lapply(1:nrow(f), fread(f[x, path])[, `:=`(
iso3 = f[x, iso3],
sheet = f[x, sheet],
year = f[x, year],
month = f[x, month]
)]) %>% rbindlist()
f <- data[iso3=="ken" & !is.na(month) & sheet=="sheet1"]
ken <- lapply(1:nrow(f), fread(f[x, path])[, `:=`(
iso3 = f[x, iso3],
sheet = f[x, sheet],
year = f[x, year],
month = f[x, month]
)]) %>% rbindlist()
ken <- lapply(1:nrow(f), function(x) fread(f[x, path])[, `:=`(
iso3 = f[x, iso3],
sheet = f[x, sheet],
year = f[x, year],
month = f[x, month]
)]) %>% rbindlist()
setnames(ken, tolower(names(ken)))
ken %>% paged_table()
ken %>% paged_table(max.print=300)
ken %>% paged_table(options=list(max.print=300))
ken %>%
ggplot() +
geom_line(aes(as.Date(paste(year, month), "%Y %m"), value, color=subclass)) +
scale_color_viridis_d(alpha=.6) +
facet_grid(paste(class, subclass, variable)~., scales="free_y") +
th() +
labs(x=NULL, y=NULL) +
ggtitle("WA+ Sheet 1 Variables", "Kenya, 2003 to 2017")
ken %>%
ggplot() +
geom_line(aes(as.Date(paste(year, month), format="%Y %m"), value, color=subclass)) +
scale_color_viridis_d(alpha=.6) +
facet_grid(paste(class, subclass, variable)~., scales="free_y") +
th() +
labs(x=NULL, y=NULL) +
ggtitle("WA+ Sheet 1 Variables", "Kenya, 2003 to 2017")
ken %>%
ggplot() +
geom_line(aes(as.Date(paste(year, month), "%Y %m"), value, color=subclass)) +
scale_color_viridis_d(alpha=.6) +
facet_grid(paste(class, subclass, variable)~., scales="free_y")
f <- data[iso3=="ken" & !is.na(month) & !is.na(year) & sheet=="sheet1"]
ken <- lapply(1:nrow(f), function(x) fread(f[x, path])[, `:=`(
iso3 = f[x, iso3],
sheet = f[x, sheet],
year = f[x, year],
month = f[x, month]
)]) %>% rbindlist()
setnames(ken, tolower(names(ken)))
ken %>% paged_table(options=list(max.print=300))
ken %>%
ggplot() +
geom_line(aes(as.Date(paste(year, month), "%Y %m"), value, color=subclass)) +
scale_color_viridis_d(alpha=.6) +
facet_grid(paste(class, subclass, variable)~., scales="free_y") +
th() +
labs(x=NULL, y=NULL) +
ggtitle("WA+ Sheet 1 Variables", "Kenya, 2003 to 2017")
ken %>%
ggplot() +
geom_line(aes(as.Date(paste(year, month), "%Y %m"), value, color=subclass)) +
scale_x_date() +
scale_color_viridis_d(alpha=.6) +
facet_grid(paste(class, subclass, variable)~., scales="free_y") +
th() +
labs(x=NULL, y=NULL) +
ggtitle("WA+ Sheet 1 Variables", "Kenya, 2003 to 2017")
?build_site()
ken %>%
ggplot() +
geom_line(aes(as.Date(paste(year, month, "01"), "%Y %m 01"), value, color=subclass)) +
scale_color_viridis_d(alpha=.6) +
facet_grid(paste(class, subclass, variable)~., scales="free_y") +
th() +
labs(x=NULL, y=NULL) +
ggtitle("WA+ Sheet 1 Variables", "Kenya, 2003 to 2017")
as.Date(paste(2003, 1), "%Y %m")
as.Date(paste(2003, 1), "%Y %m 1")
as.Date(paste(2003, 1, 1), "%Y %m %d")
ken %>%
ggplot() +
geom_line(aes(as.Date(paste(year, month, "1"), "%Y %m %d"), value, color=subclass)) +
scale_color_viridis_d(alpha=.6) +
facet_grid(paste(class, subclass, variable)~., scales="free_y") +
th() +
labs(x=NULL, y=NULL) +
ggtitle("WA+ Sheet 1 Variables", "Kenya, 2003 to 2017")
data[iso3=="ken" & is.na(sheet), .(iso3, file, sheet)] %>%
paged_table()
data[iso3=="ken" & is.na(sheet), .(iso3, file, sheet)] %>%
paged_table()
data[iso3=="ken" & is.na(year) & is.na(month), .(iso3, file, sheet)] %>%
paged_table()
data[iso3=="ken" & !is.na(month), .(iso3, file, sheet, year, month)] %>%
paged_table()
f <- data[iso3=="ken" & !is.na(month) & !is.na(year) & sheet=="sheet2"]
ken <- lapply(1:nrow(f), function(x) fread(f[x, path])[, `:=`(
iso3 = f[x, iso3],
sheet = f[x, sheet],
year = f[x, year],
month = f[x, month]
)]) %>% rbindlist()
setnames(ken, tolower(names(ken)))
ken %>% paged_table(options=list(max.print=300))
View(ken)
devtools::load_all(".")
pkg <- system.file(package="WADashboard")
pkg
fread("./inst/csv/sheet_1_schema.csv") %>% paged_table()
ym("2021-01-01")
library(lubridate)
ym("2021-01-01")
ym("2021-01")
ym("2021-04")
ym("2021")
